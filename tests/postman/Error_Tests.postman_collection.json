{
  "info": {
    "name": "Smart Inventory API - Error Tests",
    "description": "Comprehensive error testing and validation for Smart Inventory API",
    "version": "1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üö® Validation Errors",
      "item": [
        {
          "name": "üìß Invalid Email Format",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"invalid-email-format\",\n  \"password\": \"motdepasse123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email validation error', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                  "});",
                  "",
                  "pm.test('Error message contains email validation', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.error || responseJson.message).to.include('email');",
                  "});",
                  "",
                  "console.log('üìß ERREUR EMAIL - Status:', pm.response.code);",
                  "console.log('üìß ERREUR EMAIL - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        },
        {
          "name": "üîê Password Too Short",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Password length validation', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                  "});",
                  "",
                  "pm.test('Error message mentions password length', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.error || responseJson.message).to.match(/password|caract√®res/i);",
                  "});",
                  "",
                  "console.log('üîê ERREUR PASSWORD - Status:', pm.response.code);",
                  "console.log('üîê ERREUR PASSWORD - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        },
        {
          "name": "üìù Missing Required Fields",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Missing fields validation', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                  "});",
                  "",
                  "pm.test('Error response structure', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('status').or.have.property('error');",
                  "});",
                  "",
                  "console.log('üìù ERREUR CHAMPS MANQUANTS - Status:', pm.response.code);",
                  "console.log('üìù ERREUR CHAMPS MANQUANTS - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üåê HTTP Protocol Errors",
      "item": [
        {
          "name": "üîß Malformed JSON",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"test@example.com\", \"password\":"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('JSON parsing error', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "});",
                  "",
                  "pm.test('JSON error message', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.error || responseJson.message).to.match(/json|parse|syntax/i);",
                  "});",
                  "",
                  "console.log('üîß ERREUR JSON - Status:', pm.response.code);",
                  "console.log('üîß ERREUR JSON - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        },
        {
          "name": "üì° Wrong Content-Type",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "text/plain"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "email=test@example.com&password=123456"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Content-Type validation', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 415]);",
                  "});",
                  "",
                  "console.log('üì° ERREUR CONTENT-TYPE - Status:', pm.response.code);",
                  "console.log('üì° ERREUR CONTENT-TYPE - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üîê Authentication Errors",
      "item": [
        {
          "name": "üîí Missing Token",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/products",
              "host": ["{{baseUrl}}"],
              "path": ["api", "products"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Authentication required', function () {",
                  "    pm.expect(pm.response.code).to.equal(401);",
                  "});",
                  "",
                  "pm.test('Auth error message', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson.error || responseJson.message).to.match(/token|auth/i);",
                  "});",
                  "",
                  "console.log('üîí ERREUR AUTH - Status:', pm.response.code);",
                  "console.log('üîí ERREUR AUTH - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        },
        {
          "name": "üé´ Invalid Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid_token_123456"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/products",
              "host": ["{{baseUrl}}"],
              "path": ["api", "products"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invalid token rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(401);",
                  "});",
                  "",
                  "console.log('üé´ ERREUR TOKEN - Status:', pm.response.code);",
                  "console.log('üé´ ERREUR TOKEN - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üö® Security Tests",
      "item": [
        {
          "name": "üíâ NoSQL Injection Attempt",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": {\"$ne\": null},\n  \"password\": {\"$ne\": null}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('NoSQL injection blocked', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422, 500]);",
                  "});",
                  "",
                  "pm.test('No successful authentication', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.not.have.property('token');",
                  "});",
                  "",
                  "console.log('üíâ ERREUR INJECTION - Status:', pm.response.code);",
                  "console.log('üíâ ERREUR INJECTION - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        },
        {
          "name": "üî• XSS Attempt in Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"<script>alert('hack')</script>@evil.com\",\n  \"password\": \"motdepasse123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('XSS attempt handled', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422, 201]);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    pm.test('Email sanitized if accepted', function () {",
                  "        const responseJson = pm.response.json();",
                  "        if (responseJson.user && responseJson.user.email) {",
                  "            pm.expect(responseJson.user.email).to.not.include('<script>');",
                  "        }",
                  "    });",
                  "}",
                  "",
                  "console.log('üî• ERREUR XSS - Status:', pm.response.code);",
                  "console.log('üî• ERREUR XSS - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üó∫Ô∏è Route Errors",
      "item": [
        {
          "name": "üîç Non-existent Route",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/nonexistent-endpoint",
              "host": ["{{baseUrl}}"],
              "path": ["api", "nonexistent-endpoint"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Route not found', function () {",
                  "    pm.expect(pm.response.code).to.equal(404);",
                  "});",
                  "",
                  "pm.test('404 error structure', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('status').or.have.property('error');",
                  "});",
                  "",
                  "console.log('üó∫Ô∏è ERREUR 404 - Status:', pm.response.code);",
                  "console.log('üó∫Ô∏è ERREUR 404 - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        },
        {
          "name": "üÜî Invalid Resource ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/products/invalid-id-123",
              "host": ["{{baseUrl}}"],
              "path": ["api", "products", "invalid-id-123"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invalid ID handled', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 401, 404]);",
                  "});",
                  "",
                  "console.log('üÜî ERREUR ID - Status:', pm.response.code);",
                  "console.log('üÜî ERREUR ID - Body:', JSON.stringify(pm.response.json(), null, 2));"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Set base URL if not already set",
          "if (!pm.environment.get('baseUrl')) {",
          "    pm.environment.set('baseUrl', 'http://localhost:5000');",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global error logging",
          "if (pm.response.code >= 400) {",
          "    console.log('‚ùå Error Response:', {",
          "        status: pm.response.code,",
          "        url: pm.request.url.toString(),",
          "        method: pm.request.method,",
          "        body: pm.response.json()",
          "    });",
          "}"
        ]
      }
    }
  ]
}
